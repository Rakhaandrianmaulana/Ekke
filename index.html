<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Detektor Cuaca Real-Time</title>
    <!-- Memuat Tailwind CSS untuk styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Memuat ikon Phosphor Icons -->
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Animasi untuk memunculkan kartu */
        .card-enter {
            opacity: 0;
            transform: scale(0.95) translateY(20px);
            transition: opacity 0.5s ease-out, transform 0.5s ease-out;
        }
        .card-enter-active {
            opacity: 1;
            transform: scale(1) translateY(0);
        }
        /* Animasi untuk loader */
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        .loader {
            animation: spin 1s linear infinite;
        }
    </style>
</head>
<body class="bg-gray-900 flex items-center justify-center min-h-screen text-white p-4">

    <div id="weather-container" class="w-full max-w-sm mx-auto bg-gray-800 bg-opacity-60 backdrop-blur-lg rounded-3xl shadow-2xl p-8 card-enter">
        <!-- Konten akan diisi oleh JavaScript -->
    </div>

    <script>
        const weatherContainer = document.getElementById('weather-container');

        // Fungsi untuk menampilkan status loading
        const showLoading = () => {
            weatherContainer.innerHTML = `
                <div class="flex flex-col items-center justify-center space-y-4 text-center">
                    <div class="w-12 h-12 border-4 border-t-blue-500 border-gray-600 rounded-full loader"></div>
                    <h2 class="text-xl font-semibold text-gray-300">Mendeteksi Lokasi Anda...</h2>
                    <p class="text-gray-400">Harap izinkan akses lokasi di browser Anda untuk mendapatkan data cuaca akurat.</p>
                </div>
            `;
        };

        // Fungsi untuk menampilkan pesan error
        const showError = (message) => {
            weatherContainer.innerHTML = `
                <div class="flex flex-col items-center justify-center space-y-4 text-center">
                    <i class="ph-warning-circle text-red-500 text-6xl"></i>
                    <h2 class="text-xl font-semibold text-red-400">Terjadi Kesalahan</h2>
                    <p class="text-gray-400">${message}</p>
                    <button onclick="location.reload()" class="mt-4 px-4 py-2 bg-blue-600 rounded-lg hover:bg-blue-700 transition-colors">Coba Lagi</button>
                </div>
            `;
        };

        // Fungsi untuk menerjemahkan kode cuaca WMO menjadi deskripsi dan ikon
        const getWeatherInfo = (code) => {
            const weatherMap = {
                0: { description: "Cerah", icon: "ph-sun" },
                1: { description: "Cerah Berawan", icon: "ph-cloud-sun" },
                2: { description: "Berawan", icon: "ph-cloud" },
                3: { description: "Sangat Berawan", icon: "ph-clouds" },
                45: { description: "Berkabut", icon: "ph-cloud-fog" },
                48: { description: "Kabut Tebal", icon: "ph-cloud-fog" },
                51: { description: "Gerimis Ringan", icon: "ph-drizzle" },
                53: { description: "Gerimis", icon: "ph-drizzle" },
                55: { description: "Gerimis Deras", icon: "ph-drizzle" },
                61: { description: "Hujan Ringan", icon: "ph-cloud-rain" },
                63: { description: "Hujan", icon: "ph-cloud-rain" },
                65: { description: "Hujan Lebat", icon: "ph-cloud-rain" },
                71: { description: "Salju Ringan", icon: "ph-cloud-snow" },
                73: { description: "Salju", icon: "ph-cloud-snow" },
                75: { description: "Salju Lebat", icon: "ph-cloud-snow" },
                80: { description: "Hujan Ringan", icon: "ph-cloud-lightning" },
                81: { description: "Hujan Petir", icon: "ph-cloud-lightning" },
                82: { description: "Hujan Petir Hebat", icon: "ph-cloud-lightning" },
                95: { description: "Badai Petir", icon: "ph-lightning" },
                96: { description: "Badai Petir & Hujan", icon: "ph-lightning" },
                99: { description: "Badai Petir & Hujan Es", icon: "ph-lightning" },
            };
            return weatherMap[code] || { description: "Tidak Diketahui", icon: "ph-question" };
        };

        // Fungsi utama untuk mendapatkan data dan menampilkannya
        const getWeatherData = async (lat, lon) => {
            try {
                // 1. Ambil nama lokasi berdasarkan latitude dan longitude
                const geoApiUrl = `https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lon}`;
                const geoResponse = await fetch(geoApiUrl);
                if (!geoResponse.ok) throw new Error("Gagal mengambil data lokasi.");
                const geoData = await geoResponse.json();
                const locationName = geoData.address.city || geoData.address.town || geoData.address.village || "Lokasi Anda";

                // 2. Ambil data cuaca
                const weatherApiUrl = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current_weather=true&timezone=auto`;
                const weatherResponse = await fetch(weatherApiUrl);
                if (!weatherResponse.ok) throw new Error("Gagal mengambil data cuaca.");
                const weatherData = await weatherResponse.json();
                
                const { temperature, windspeed, weathercode } = weatherData.current_weather;
                const { description, icon } = getWeatherInfo(weathercode);

                // 3. Tampilkan hasil
                weatherContainer.innerHTML = `
                    <div class="text-center space-y-2">
                        <p class="text-lg font-medium text-gray-300 flex items-center justify-center gap-2">
                            <i class="ph-map-pin"></i>
                            ${locationName}
                        </p>
                        <div class="flex justify-center items-center">
                            <i class="${icon} text-8xl text-yellow-300"></i>
                        </div>
                        <h1 class="text-6xl font-bold">${Math.round(temperature)}<span class="text-4xl align-top">&deg;C</span></h1>
                        <p class="text-2xl text-gray-200">${description}</p>
                    </div>
                    <div class="mt-8 pt-6 border-t border-gray-700 flex justify-around">
                        <div class="text-center">
                            <p class="text-gray-400 text-sm">Kecepatan Angin</p>
                            <p class="font-semibold text-lg">${windspeed} km/j</p>
                        </div>
                         <div class="text-center">
                            <p class="text-gray-400 text-sm">Zona Waktu</p>
                            <p class="font-semibold text-lg">${weatherData.timezone.replace('/', '/ ')}</p>
                        </div>
                    </div>
                `;
            } catch (error) {
                console.error("Error fetching data:", error);
                showError("Gagal memuat data. Periksa koneksi internet Anda.");
            }
        };

        // Event listener yang dijalankan saat halaman selesai dimuat
        document.addEventListener('DOMContentLoaded', () => {
            showLoading();
            
            // Tambahkan kelas animasi setelah sedikit jeda agar terlihat
            setTimeout(() => {
                weatherContainer.classList.add('card-enter-active');
            }, 100);

            if (!navigator.geolocation) {
                showError("Browser Anda tidak mendukung Geolocation.");
                return;
            }

            // Meminta lokasi pengguna
            navigator.geolocation.getCurrentPosition(
                (position) => {
                    const { latitude, longitude } = position.coords;
                    getWeatherData(latitude, longitude);
                },
                (error) => {
                    switch (error.code) {
                        case error.PERMISSION_DENIED:
                            showError("Anda menolak izin akses lokasi. Aplikasi tidak dapat berfungsi.");
                            break;
                        case error.POSITION_UNAVAILABLE:
                            showError("Informasi lokasi tidak tersedia saat ini.");
                            break;
                        case error.TIMEOUT:
                            showError("Waktu permintaan lokasi habis.");
                            break;
                        default:
                            showError("Terjadi kesalahan yang tidak diketahui saat mengambil lokasi.");
                            break;
                    }
                }
            );
        });
    </script>
</body>
</html>
